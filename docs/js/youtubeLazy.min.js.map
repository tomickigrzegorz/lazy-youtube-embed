{"version":3,"file":"youtubeLazy.min.js","sources":["../../sources/js/utils/function.ts","../../sources/js/index.ts"],"sourcesContent":["/**\r\n * Create picure or source element\r\n *\r\n * @param el - type of element\r\n * @param config - config element\r\n * @returns {HTMLElement}\r\n */\r\nconst createElement = (el: string, config?: object | string): HTMLElement => {\r\n  const element = document.createElement(el);\r\n  if (config) {\r\n    setAttribute(\r\n      element,\r\n      typeof config === \"string\" ? { class: config } : config\r\n    );\r\n  }\r\n  return element;\r\n};\r\n\r\n/**\r\n * @param element - element html\r\n * @param config - attributes\r\n */\r\nconst setAttribute = (element: HTMLElement, config?: LooseObject) => {\r\n  for (var key in config) {\r\n    element.setAttribute(key, config[key]);\r\n  }\r\n};\r\n\r\n/**\r\n * @param object - object\r\n */\r\nconst parseJson = (object: any) => JSON.parse(object);\r\n\r\n/**\r\n * @returns red button\r\n */\r\nconst createRedButton = () => createElement(\"div\", \"ytLazy__img--svg\");\r\n\r\n/**\r\n * @function debounce - debounce function\r\n *\r\n * @param {Function} fn function\r\n * @param {Number} ms time\r\n */\r\nconst debounce = (fn: Function, ms = 300) => {\r\n  let timeoutId: ReturnType<typeof setTimeout>;\r\n  return function (this: any, ...args: any[]) {\r\n    clearTimeout(timeoutId);\r\n    timeoutId = setTimeout(() => fn.apply(this, args), ms);\r\n  };\r\n};\r\n\r\nexport { createElement, setAttribute, parseJson, debounce, createRedButton };\r\n","import {\r\n  createElement,\r\n  createRedButton,\r\n  parseJson,\r\n  debounce,\r\n  setAttribute,\r\n} from \"./utils/function\";\r\n\r\nexport default class ytLazy {\r\n  private _className: string;\r\n  private _overLayer: HTMLElement;\r\n  private _link: string;\r\n  private _background?: string;\r\n  private _picture?: boolean;\r\n  private _local?: boolean;\r\n  private _overflow?: boolean;\r\n  private _maxWidth?: number;\r\n  private _createWatchIn: Function;\r\n  private _onResize: Function;\r\n\r\n  constructor(\r\n    classElement: string,\r\n    {\r\n      background = \"rgba(0,0,0,0.9)\",\r\n      maxWidth = 90,\r\n      overflow = false,\r\n      local = true,\r\n      picture = false,\r\n      onResize = () => {},\r\n      createWatchIn = () => {},\r\n    }: ConstructorObject\r\n  ) {\r\n    this._className = classElement;\r\n    this._background = background;\r\n    this._local = local;\r\n    this._overflow = overflow;\r\n    this._picture = picture;\r\n    this._maxWidth = maxWidth;\r\n    this._createWatchIn = createWatchIn;\r\n    this._onResize = onResize;\r\n    this._link = \"https://www.youtube.com\";\r\n\r\n    this._overLayer = createElement(\"div\", \"ytLight\");\r\n\r\n    document.body.appendChild(this._overLayer);\r\n\r\n    this._initial();\r\n  }\r\n\r\n  _initial = () => {\r\n    const getYTLazy = document.querySelectorAll(`.${this._className}`);\r\n\r\n    for (let i = 0; i < getYTLazy.length; i++) {\r\n      const { id, openIn, title, picture } = parseJson(\r\n        getYTLazy[i].getAttribute(\"data-yt\")\r\n      );\r\n\r\n      // add image\r\n      getYTLazy[i].appendChild(this._createImage(id, picture));\r\n\r\n      // add red button\r\n      getYTLazy[i].appendChild(createRedButton());\r\n\r\n      if (title ?? false) {\r\n        const titleElement = createElement(\"div\", \"ytLazy__title\");\r\n        titleElement.textContent = title;\r\n        getYTLazy[i].insertAdjacentElement(\"beforeend\", titleElement);\r\n        titleElement.insertAdjacentElement(\r\n          \"afterend\",\r\n          createElement(\"div\", \"ytLazy__gradient-top\")\r\n        );\r\n      }\r\n\r\n      if (openIn && this._createWatchIn) {\r\n        this._createWatchIn({\r\n          index: i,\r\n          link: this._link + \"/watch?v=\" + id,\r\n          template: (template: string) => {\r\n            getYTLazy[i].insertAdjacentHTML(\"beforeend\", template);\r\n          },\r\n        });\r\n      }\r\n    }\r\n\r\n    this._handEvent();\r\n  };\r\n\r\n  /**\r\n   * Create image or picture width image\r\n   *\r\n   * @param id - id video\r\n   * @returns {HTMLImageElement}\r\n   */\r\n  _createImage = (id: string, pic: string | null): HTMLElement => {\r\n    const sourcesArray: ConfigObject[] = [\r\n      {\r\n        media: \"(min-width: 1440px)\",\r\n        srcset: this._sourceURL(id, \"maxresdefault\"),\r\n      },\r\n      {\r\n        media: \"(min-width: 1024px)\",\r\n        srcset: this._sourceURL(id, \"hqdefault\"),\r\n      },\r\n      {\r\n        media: \"(min-width: 480px)\",\r\n        srcset: this._sourceURL(id, \"mqdefault\"),\r\n      },\r\n    ];\r\n\r\n    const picture = createElement(\"picture\");\r\n    sourcesArray.map((element: object) => {\r\n      picture.appendChild(createElement(\"source\", element));\r\n    });\r\n\r\n    const image = new Image();\r\n    image.className = \"ytLazy__image\";\r\n    image.loading = \"lazy\";\r\n    image.width = 1050;\r\n    image.height = 787;\r\n    image.src = this._sourceURL(id, \"sddefault\");\r\n\r\n    picture.appendChild(image);\r\n\r\n    return this._picture || pic ? picture : image;\r\n  };\r\n\r\n  /**\r\n   * Image url\r\n   *\r\n   * @param id - movie\r\n   * @param type - image size\r\n   * @returns {HTMLImageElement}\r\n   */\r\n  _sourceURL = (id: string, type: string): string => {\r\n    return `//i.ytimg.com/vi/${id}/${type}.jpg`;\r\n  };\r\n\r\n  /**\r\n   *\r\n   * @param target - target element\r\n   */\r\n  _setLightbox = (target: HTMLElement) => {\r\n    const watchIn = target.closest(\".ytLazy__watch-in-link\");\r\n    if (watchIn) return;\r\n\r\n    const element = target.closest(\".ytLazy__item\");\r\n\r\n    if (element === null || !element.classList.contains(this._className))\r\n      return;\r\n\r\n    const { id, local, maxWidth } = parseJson(element.getAttribute(\"data-yt\"));\r\n\r\n    if (local ?? this._local) {\r\n      const frame = createElement(\"iframe\", this._objectIframe(id, this._link));\r\n      setAttribute(frame, {\r\n        width: \"100%\",\r\n        height: \"100%\",\r\n      });\r\n\r\n      element.textContent = \"\";\r\n      element.appendChild(frame);\r\n\r\n      return;\r\n    } else {\r\n      this._lightbox({ id, maxWidth });\r\n    }\r\n  };\r\n\r\n  // close lightbox\r\n  _closeLightbox = () => {\r\n    const isOpen = document.querySelector(\".ytLazy-is-open\");\r\n    if (!isOpen) return;\r\n    isOpen.textContent = \"\";\r\n    isOpen.classList.remove(\"ytLazy-is-open\");\r\n    this._overflow && document.body.classList.remove(\"ytLight-active\");\r\n  };\r\n\r\n  _handClick = (event: Event) => {\r\n    event.stopPropagation();\r\n    const { target } = event;\r\n\r\n    this._closeLightbox();\r\n    this._setLightbox(<HTMLElement>target);\r\n  };\r\n\r\n  _handKey = (event: KeyboardEvent) => {\r\n    if (event.key !== \"Escape\") return;\r\n    this._setLightbox(<HTMLElement>event.target);\r\n    this._closeLightbox();\r\n  };\r\n\r\n  _handEvent = () => {\r\n    window.addEventListener(\"click\", this._handClick);\r\n    window.addEventListener(\"keydown\", this._handKey);\r\n\r\n    window.addEventListener(\r\n      \"DOMContentLoaded\",\r\n      () => (this._local = this._onResize())\r\n    );\r\n    window.addEventListener(\r\n      \"resize\",\r\n      debounce(() => (this._local = this._onResize()), 70)\r\n    );\r\n  };\r\n\r\n  _objectIframe = (id: string, link: string): object => {\r\n    return {\r\n      frameborder: \"0\",\r\n      allowfullscreen: \"true\",\r\n      allow:\r\n        \"accelerometer;autoplay;encrypted-media;gyroscope;picture-in-picture;\",\r\n      src: `${link}/embed/${id}?autoplay=1`,\r\n    };\r\n  };\r\n\r\n  _lightbox = ({ id, maxWidth }: lightboxObject) => {\r\n    if (this._overflow) {\r\n      document.body.classList.add(\"ytLight-active\");\r\n    }\r\n\r\n    const button = createElement(\"button\", \"ytLight-close\");\r\n    setAttribute(button, {\r\n      type: \"button\",\r\n      title: \"close movie\",\r\n    });\r\n\r\n    const wrap = createElement(\"div\", \"ytLight-wrap\");\r\n    const container = createElement(\"div\", \"ytLight-container\");\r\n\r\n    (this._maxWidth || maxWidth) &&\r\n      setAttribute(container, {\r\n        style: `max-width: ${maxWidth || this._maxWidth}%`,\r\n      });\r\n\r\n    const iframCointainer = createElement(\"div\", \"ytLight-iframe\");\r\n\r\n    iframCointainer.appendChild(\r\n      createElement(\"iframe\", this._objectIframe(id, this._link))\r\n    );\r\n    container.appendChild(iframCointainer);\r\n    wrap.appendChild(container);\r\n\r\n    iframCointainer.insertAdjacentElement(\"afterend\", button);\r\n\r\n    this._overLayer.appendChild(wrap);\r\n    this._overLayer.classList.add(\"ytLazy-is-open\");\r\n    this._overLayer.setAttribute(\"style\", `background:${this._background};`);\r\n  };\r\n}\r\n"],"names":["createElement","el","config","element","document","setAttribute","class","key","parseJson","object","JSON","parse","debounce","fn","ms","timeoutId","args","clearTimeout","setTimeout","apply","this","constructor","classElement","background","maxWidth","overflow","local","picture","onResize","createWatchIn","_initial","getYTLazy","querySelectorAll","_className","i","length","id","openIn","title","getAttribute","appendChild","_createImage","titleElement","textContent","insertAdjacentElement","_createWatchIn","index","link","_link","template","insertAdjacentHTML","_handEvent","pic","sourcesArray","media","srcset","_sourceURL","map","image","Image","className","loading","width","height","src","_picture","type","_setLightbox","target","closest","classList","contains","_local","frame","_objectIframe","_lightbox","_closeLightbox","isOpen","querySelector","remove","_overflow","body","_handClick","event","stopPropagation","_handKey","window","addEventListener","_onResize","frameborder","allowfullscreen","allow","add","button","wrap","container","_maxWidth","style","iframCointainer","_overLayer","_background"],"mappings":"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"}